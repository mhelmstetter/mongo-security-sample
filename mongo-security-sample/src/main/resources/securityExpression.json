{
    $cond: [
        {
            $allElementsTrue: {
                $map: {
                    input: {
                        $ifNull: ["$sl", [
                            []
                        ]]
                    },
                    "as": "setNeeded",
                    "in": {
                        $setIsSubset: [
                            "$$setNeeded",
%s
]
}
}
}
},
"$$DESCEND",
"$$PRUNE"
]
}


function getRedact(userAttributes) {
return  {
$redact: {
$cond: {
if: {
$allElementsTrue : {
$map : {
input: {$ifNull:["$sl",[[]]]},
"as" : "setNeeded",
"in" : {
$cond: {
if: {
$or: [
{ $eq: [ { $size: "$$setNeeded" }, 0 ] },
{ $gt: [ { $size: { $setIntersection: [ "$$setNeeded", userAttributes ] } }, 0 ] }
]
},
then: true,
else: false
}
}
}
}
},
then: "$$DESCEND",
else: "$$PRUNE"
}
}
}
}